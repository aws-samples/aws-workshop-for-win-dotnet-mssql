



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A collection of Windows on AWS workshops">
      
      
        <link rel="canonical" href="https://awsentworkshops.com/reinvent2018/dev334/challenge1/">
      
      
        <meta name="author" content="aws-ent-workshops@amazon.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.1">
    
    
      
        <title>Powershell exercise - Windows on AWS Workshops</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.3020aac5.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#create-aws-resources-using-powershell" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../../../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Windows on AWS Workshops
                </span>
                <span class="md-header-nav__topic">
                  Powershell exercise
                </span>
              
            
          </div>
        </div>
  
        <!-- Button to open search dialogue -->
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              <!-- Search interface -->
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>
        
        <!-- Repository containing source -->
        
        <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__lang">
                <div class="md-lang-drop">
                    <button onmouseover="langToggle()" class="md-lang-dropbtn fa fa-globe"></button>
                </div>
            </div>
        </div>

        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/aws-samples/aws-workshop-for-win-dotnet-mssql/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/aws-workshop-for-win-dotnet-mssql
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../index2018/" title="re:Invent 2018" class="md-tabs__link md-tabs__link--active">
          re:Invent 2018
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../reinvent2019/index2019/" title="re:Invent 2019" class="md-tabs__link">
          re:Invent 2019
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../builder-sessions/" title="Builder Sessions" class="md-tabs__link">
          Builder Sessions
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../workshops/" title="Full Day Workshops" class="md-tabs__link">
          Full Day Workshops
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://awsentworkshops.com" title="Windows on AWS Workshops" class="md-nav__button md-logo">
      
        <img src="../../../assets/images/aws_smile_logo.png" width="48" height="48">
      
    </a>
    Windows on AWS Workshops
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/aws-samples/aws-workshop-for-win-dotnet-mssql/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/aws-workshop-for-win-dotnet-mssql
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      re:Invent 2018
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        re:Invent 2018
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../index2018/" title="Directory" class="md-nav__link">
      Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Win319
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Win319
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/win319index/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/prereq/" title="Pre-Requisite" class="md-nav__link">
      Pre-Requisite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/1_DeployAd/" title="Create Directory" class="md-nav__link">
      Create Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/2_DeployMad/" title="Deploy Managed AD" class="md-nav__link">
      Deploy Managed AD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/3_Trust/" title="Create Domain Trust" class="md-nav__link">
      Create Domain Trust
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/4_Createorg/" title="Create AWS Organization" class="md-nav__link">
      Create AWS Organization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/5_ConnectADtoSSO/" title="Connect AD to SSO" class="md-nav__link">
      Connect AD to SSO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/6_VerifyADSSO_MAD/" title="Verify SSO" class="md-nav__link">
      Verify SSO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Win313
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Win313
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win313/win313index/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win313/setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-3" type="checkbox" id="nav-3-3-3">
    
    <label class="md-nav__link" for="nav-3-3-3">
      Challenges
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-3">
        Challenges
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win313/ec2/" title="Amazon EC2" class="md-nav__link">
      Amazon EC2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win313/lambda/" title="AWS Lambda" class="md-nav__link">
      AWS Lambda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win313/fargate/" title="Amazon ECS Fargate" class="md-nav__link">
      Amazon ECS Fargate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win313/resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Win308
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Win308
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win308/win308index/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win308/prereq/" title="Pre-requisites" class="md-nav__link">
      Pre-requisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-3" type="checkbox" id="nav-3-4-3">
    
    <label class="md-nav__link" for="nav-3-4-3">
      Challenges
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-3">
        Challenges
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win308/challenge1/" title="Challenge 1 Configuring resources using AWS Tools for Windows PowerShell" class="md-nav__link">
      Challenge 1 Configuring resources using AWS Tools for Windows PowerShell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win308/challenge2/" title="Challenge 2 Configure EC2 instances using Powershell and SSM" class="md-nav__link">
      Challenge 2 Configure EC2 instances using Powershell and SSM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      Win309
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        Win309
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win309/win309index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win309/prereq/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win309/resources/" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">
    
    <label class="md-nav__link" for="nav-3-6">
      Win314
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        Win314
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win314/win314index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win314/build/" title="Let's Build" class="md-nav__link">
      Let's Build
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Win310
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Win310
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/win310index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/scenario/" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/rehost/" title="Rehost" class="md-nav__link">
      Rehost
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/replatform/" title="Replatform" class="md-nav__link">
      Replatform
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/refactor/" title="Refactor" class="md-nav__link">
      Refactor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/bonus/" title="Bonus" class="md-nav__link">
      Bonus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8" checked>
    
    <label class="md-nav__link" for="nav-3-8">
      Dev334
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        Dev334
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../dev334index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prereq/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8-4" type="checkbox" id="nav-3-8-4" checked>
    
    <label class="md-nav__link" for="nav-3-8-4">
      Challenges
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-8-4">
        Challenges
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Powershell exercise
      </label>
    
    <a href="./" title="Powershell exercise" class="md-nav__link md-nav__link--active">
      Powershell exercise
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-aws-resources-using-powershell" title="Create AWS resources using Powershell" class="md-nav__link">
    Create AWS resources using Powershell
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-new-vpc-with-a-specific-cidr-block" title="Creating new VPC with a specific CIDR block" class="md-nav__link">
    Creating new VPC with a specific CIDR block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-the-vpc-we-just-created" title="Tag the VPC we just created" class="md-nav__link">
    Tag the VPC we just created
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-an-internet-gateway-for-internet-access" title="Creating an Internet Gateway for internet access" class="md-nav__link">
    Creating an Internet Gateway for internet access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-if-internet-gateway-was-created" title="Check if Internet Gateway was created" class="md-nav__link">
    Check if Internet Gateway was created
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-the-internet-gateway-associated-with-newly-created-vpc-and-store-it-as-a-variable" title="Find the Internet Gateway associated with newly created VPC and store it as a variable" class="md-nav__link">
    Find the Internet Gateway associated with newly created VPC and store it as a variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-main-route-table-that-got-created-with-vpc" title="Find main Route Table that got created with VPC" class="md-nav__link">
    Find main Route Table that got created with VPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store-main-route-table-in-a-variable" title="Store main Route Table in a variable" class="md-nav__link">
    Store main Route Table in a variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-route-table-as-public" title="Tag Route Table as Public" class="md-nav__link">
    Tag Route Table as Public
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-routes" title="Add Routes" class="md-nav__link">
    Add Routes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-public-subnet" title="Create Public Subnet" class="md-nav__link">
    Create Public Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-public-subnet-to-public-route-table" title="Register Public Subnet to Public Route Table" class="md-nav__link">
    Register Public Subnet to Public Route Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-public-subnet" title="Tag Public Subnet" class="md-nav__link">
    Tag Public Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-nat-gateway" title="Create NAT Gateway" class="md-nav__link">
    Create NAT Gateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-elastic-ip" title="Check Elastic IP" class="md-nav__link">
    Check Elastic IP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#now-create-nat-gateway" title="Now Create NAT Gateway" class="md-nav__link">
    Now Create NAT Gateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-status-of-nat-gateway-creation" title="Check status of NAT Gateway creation" class="md-nav__link">
    Check status of NAT Gateway creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wait-till-the-result-of-this-cmdlet-shows-nat-gateway-as-available" title="Wait till the result of this cmdlet shows NAT Gateway as Available" class="md-nav__link">
    Wait till the result of this cmdlet shows NAT Gateway as Available
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-private-route-table" title="Create Private Route Table" class="md-nav__link">
    Create Private Route Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-private-route-table" title="Tag Private Route Table" class="md-nav__link">
    Tag Private Route Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#route-internet-traffic-through-nat-gateway-for-private-subnet" title="Route internet traffic through NAT Gateway for Private Subnet" class="md-nav__link">
    Route internet traffic through NAT Gateway for Private Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-private-subnet" title="Create Private Subnet" class="md-nav__link">
    Create Private Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-private-subnet" title="Tag Private Subnet" class="md-nav__link">
    Tag Private Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-private-subnet-to-private-route-table" title="Register Private Subnet to Private Route table" class="md-nav__link">
    Register Private Subnet to Private Route table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-ports-ingress-ip-range-etc-for-sg" title="Define Ports, Ingress, IP Range etc for SG" class="md-nav__link">
    Define Ports, Ingress, IP Range etc for SG
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-ports-for-security-group-if-needed" title="More Ports for Security Group if needed" class="md-nav__link">
    More Ports for Security Group if needed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-sg" title="Create SG" class="md-nav__link">
    Create SG
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-sure-security-group-has-been-created" title="Make sure Security Group has been created" class="md-nav__link">
    Make sure Security Group has been created
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-ingress-access-in-security-group" title="Grant ingress access in Security Group" class="md-nav__link">
    Grant ingress access in Security Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-egress-access-in-sg-allow-all-to-keep-it-stateful" title="Grant egress access in SG (allow-all to keep it stateful)" class="md-nav__link">
    Grant egress access in SG (allow-all to keep it stateful)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-pem-key-for-ec2" title="Create PEM key for EC2" class="md-nav__link">
    Create PEM key for EC2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-windows-2016-ec2-instance" title="Create Windows 2016 EC2 instance" class="md-nav__link">
    Create Windows 2016 EC2 instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-tag-for-ec2" title="Create Tag for EC2" class="md-nav__link">
    Create Tag for EC2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-assign-ipv4-since-we-need-a-public-ip-to-log-into-ec2" title="Auto assign IPv4 since we need a public IP to log into EC2" class="md-nav__link">
    Auto assign IPv4 since we need a public IP to log into EC2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-iis-and-the-sample-website" title="Setup IIS and the sample website" class="md-nav__link">
    Setup IIS and the sample website
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-windows-ec2-instance" title="Create Windows EC2 instance" class="md-nav__link">
    Create Windows EC2 instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-ec2-instance-and-pass-ps-userdata-file-to-install-iis" title="Create EC2 instance and pass PS Userdata file to Install IIS" class="md-nav__link">
    Create EC2 instance and pass PS Userdata file to Install IIS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-ip-address-of-the-newly-created-ec2-instance" title="Get IP address of the newly created EC2 instance" class="md-nav__link">
    Get IP address of the newly created EC2 instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-website" title="Test the website" class="md-nav__link">
    Test the website
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      re:Invent 2019
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        re:Invent 2019
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reinvent2019/index2019/" title="Directory" class="md-nav__link">
      Directory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Builder Sessions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Builder Sessions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../builder-sessions/" title="Directory" class="md-nav__link">
      Directory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Full Day Workshops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Full Day Workshops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../workshops/" title="Directory" class="md-nav__link">
      Directory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-aws-resources-using-powershell" title="Create AWS resources using Powershell" class="md-nav__link">
    Create AWS resources using Powershell
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-new-vpc-with-a-specific-cidr-block" title="Creating new VPC with a specific CIDR block" class="md-nav__link">
    Creating new VPC with a specific CIDR block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-the-vpc-we-just-created" title="Tag the VPC we just created" class="md-nav__link">
    Tag the VPC we just created
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-an-internet-gateway-for-internet-access" title="Creating an Internet Gateway for internet access" class="md-nav__link">
    Creating an Internet Gateway for internet access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-if-internet-gateway-was-created" title="Check if Internet Gateway was created" class="md-nav__link">
    Check if Internet Gateway was created
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-the-internet-gateway-associated-with-newly-created-vpc-and-store-it-as-a-variable" title="Find the Internet Gateway associated with newly created VPC and store it as a variable" class="md-nav__link">
    Find the Internet Gateway associated with newly created VPC and store it as a variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-main-route-table-that-got-created-with-vpc" title="Find main Route Table that got created with VPC" class="md-nav__link">
    Find main Route Table that got created with VPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store-main-route-table-in-a-variable" title="Store main Route Table in a variable" class="md-nav__link">
    Store main Route Table in a variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-route-table-as-public" title="Tag Route Table as Public" class="md-nav__link">
    Tag Route Table as Public
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-routes" title="Add Routes" class="md-nav__link">
    Add Routes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-public-subnet" title="Create Public Subnet" class="md-nav__link">
    Create Public Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-public-subnet-to-public-route-table" title="Register Public Subnet to Public Route Table" class="md-nav__link">
    Register Public Subnet to Public Route Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-public-subnet" title="Tag Public Subnet" class="md-nav__link">
    Tag Public Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-nat-gateway" title="Create NAT Gateway" class="md-nav__link">
    Create NAT Gateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-elastic-ip" title="Check Elastic IP" class="md-nav__link">
    Check Elastic IP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#now-create-nat-gateway" title="Now Create NAT Gateway" class="md-nav__link">
    Now Create NAT Gateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-status-of-nat-gateway-creation" title="Check status of NAT Gateway creation" class="md-nav__link">
    Check status of NAT Gateway creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wait-till-the-result-of-this-cmdlet-shows-nat-gateway-as-available" title="Wait till the result of this cmdlet shows NAT Gateway as Available" class="md-nav__link">
    Wait till the result of this cmdlet shows NAT Gateway as Available
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-private-route-table" title="Create Private Route Table" class="md-nav__link">
    Create Private Route Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-private-route-table" title="Tag Private Route Table" class="md-nav__link">
    Tag Private Route Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#route-internet-traffic-through-nat-gateway-for-private-subnet" title="Route internet traffic through NAT Gateway for Private Subnet" class="md-nav__link">
    Route internet traffic through NAT Gateway for Private Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-private-subnet" title="Create Private Subnet" class="md-nav__link">
    Create Private Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-private-subnet" title="Tag Private Subnet" class="md-nav__link">
    Tag Private Subnet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-private-subnet-to-private-route-table" title="Register Private Subnet to Private Route table" class="md-nav__link">
    Register Private Subnet to Private Route table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-ports-ingress-ip-range-etc-for-sg" title="Define Ports, Ingress, IP Range etc for SG" class="md-nav__link">
    Define Ports, Ingress, IP Range etc for SG
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-ports-for-security-group-if-needed" title="More Ports for Security Group if needed" class="md-nav__link">
    More Ports for Security Group if needed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-sg" title="Create SG" class="md-nav__link">
    Create SG
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-sure-security-group-has-been-created" title="Make sure Security Group has been created" class="md-nav__link">
    Make sure Security Group has been created
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-ingress-access-in-security-group" title="Grant ingress access in Security Group" class="md-nav__link">
    Grant ingress access in Security Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-egress-access-in-sg-allow-all-to-keep-it-stateful" title="Grant egress access in SG (allow-all to keep it stateful)" class="md-nav__link">
    Grant egress access in SG (allow-all to keep it stateful)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-pem-key-for-ec2" title="Create PEM key for EC2" class="md-nav__link">
    Create PEM key for EC2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-windows-2016-ec2-instance" title="Create Windows 2016 EC2 instance" class="md-nav__link">
    Create Windows 2016 EC2 instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-tag-for-ec2" title="Create Tag for EC2" class="md-nav__link">
    Create Tag for EC2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-assign-ipv4-since-we-need-a-public-ip-to-log-into-ec2" title="Auto assign IPv4 since we need a public IP to log into EC2" class="md-nav__link">
    Auto assign IPv4 since we need a public IP to log into EC2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-iis-and-the-sample-website" title="Setup IIS and the sample website" class="md-nav__link">
    Setup IIS and the sample website
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-windows-ec2-instance" title="Create Windows EC2 instance" class="md-nav__link">
    Create Windows EC2 instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-ec2-instance-and-pass-ps-userdata-file-to-install-iis" title="Create EC2 instance and pass PS Userdata file to Install IIS" class="md-nav__link">
    Create EC2 instance and pass PS Userdata file to Install IIS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-ip-address-of-the-newly-created-ec2-instance" title="Get IP address of the newly created EC2 instance" class="md-nav__link">
    Get IP address of the newly created EC2 instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-website" title="Test the website" class="md-nav__link">
    Test the website
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-workshop-for-win-dotnet-mssql/edit/master/docs/reinvent2018/dev334/challenge1.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Powershell exercise</h1>
                
                <h2 id="create-aws-resources-using-powershell">Create AWS resources using Powershell</h2>
<h4 id="creating-new-vpc-with-a-specific-cidr-block">Creating new VPC with a specific CIDR block</h4>
<div class="codehilite"><pre><span></span><span class="nv">$newvpc</span> <span class="p">=</span> <span class="nb">New-EC2Vpc</span> <span class="n">-CidrBlock</span> <span class="n">10</span><span class="p">.</span><span class="n">233</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">20</span> <span class="n">-InstanceTenancy</span> <span class="k">default</span>
<span class="nv">$vpcid</span> <span class="p">=</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">vpcid</span>
</pre></div>


<h4 id="tag-the-vpc-we-just-created">Tag the VPC we just created</h4>
<div class="codehilite"><pre><span></span><span class="nv">$vpctag</span><span class="p">=</span><span class="nb">New-Object</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">EC2</span><span class="p">.</span><span class="n">Model</span><span class="p">.</span><span class="n">Tag</span>
<span class="nv">$vpctag</span><span class="p">.</span><span class="n">Key</span> <span class="p">=</span> <span class="s2">&quot;Name&quot;</span>
<span class="nv">$vpctag</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&quot;DEV334&quot;</span>
<span class="nb">New-EC2Tag</span> <span class="n">-resource</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">VpcId</span> <span class="n">-Tag</span> <span class="nv">$vpctag</span>
</pre></div>


<h4 id="creating-an-internet-gateway-for-internet-access">Creating an Internet Gateway for internet access</h4>
<div class="codehilite"><pre><span></span><span class="nv">$igw</span> <span class="p">=</span> <span class="nb">New-EC2InternetGateway</span> <span class="p">|</span> <span class="nb">Add-EC2InternetGateway</span> <span class="n">-VpcId</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">VpcId</span>
</pre></div>


<h4 id="check-if-internet-gateway-was-created">Check if Internet Gateway was created</h4>
<div class="codehilite"><pre><span></span><span class="nb">Get-EC2InternetGateway</span> <span class="n">-Filter</span> <span class="p">@{</span> <span class="n">Name</span><span class="p">=</span><span class="s2">&quot;attachment.vpc-id&quot;</span><span class="p">;</span> <span class="n">Values</span><span class="p">=</span><span class="s2">&quot;$vpcid&quot;</span> <span class="p">}</span>
</pre></div>


<h4 id="find-the-internet-gateway-associated-with-newly-created-vpc-and-store-it-as-a-variable">Find the Internet Gateway associated with newly created VPC and store it as a variable</h4>
<div class="codehilite"><pre><span></span><span class="nv">$igwid</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-EC2InternetGateway</span> <span class="n">-filter</span> <span class="p">@{</span> <span class="n">Name</span><span class="p">=</span><span class="s2">&quot;attachment.vpc-id&quot;</span><span class="p">;</span> <span class="n">Values</span><span class="p">=</span><span class="s2">&quot;$vpcid&quot;</span> <span class="p">}).</span><span class="n">InternetGatewayId</span>
</pre></div>


<h4 id="find-main-route-table-that-got-created-with-vpc">Find main Route Table that got created with VPC</h4>
<div class="codehilite"><pre><span></span><span class="nb">Get-EC2RouteTable</span> <span class="n">-Filter</span> <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;vpc-id&quot;</span><span class="p">;</span> <span class="n">Value</span> <span class="p">=</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">vpcid</span> <span class="p">}</span>
</pre></div>


<h4 id="store-main-route-table-in-a-variable">Store main Route Table in a variable</h4>
<div class="codehilite"><pre><span></span><span class="nv">$mainroutetable</span> <span class="p">=</span> <span class="nb">Get-EC2RouteTable</span> <span class="n">-Filter</span> <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;vpc-id&quot;</span><span class="p">;</span> <span class="n">Value</span> <span class="p">=</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">vpcid</span> <span class="p">}</span>
</pre></div>


<blockquote>
<p>No need to create a new  route table since we can use $mainroutetable as public route table</p>
</blockquote>
<h4 id="tag-route-table-as-public">Tag Route Table as Public</h4>
<div class="codehilite"><pre><span></span><span class="nv">$pubrttag</span><span class="p">=</span><span class="nb">New-Object</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">EC2</span><span class="p">.</span><span class="n">Model</span><span class="p">.</span><span class="n">Tag</span>
<span class="nv">$pubrttag</span><span class="p">.</span><span class="n">Key</span> <span class="p">=</span> <span class="s2">&quot;Name&quot;</span>
<span class="nv">$pubrttag</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&quot;DEV334-PubRoute-1&quot;</span>
<span class="nb">New-EC2Tag</span> <span class="n">-Resource</span> <span class="nv">$mainroutetable</span><span class="p">.</span><span class="n">RouteTableId</span> <span class="n">-Tag</span> <span class="nv">$pubrttag</span>
</pre></div>


<h4 id="add-routes">Add Routes</h4>
<div class="codehilite"><pre><span></span><span class="nb">New-EC2Route</span> <span class="n">-RouteTableId</span> <span class="nv">$mainroutetable</span><span class="p">.</span><span class="n">RouteTableId</span> <span class="n">-DestinationCidrBlock</span> <span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">0</span> <span class="n">-GatewayId</span> <span class="nv">$igwid</span>
</pre></div>


<h4 id="create-public-subnet">Create Public Subnet</h4>
<div class="codehilite"><pre><span></span><span class="nv">$pubsub</span> <span class="p">=</span> <span class="nb">New-EC2Subnet</span> <span class="n">-VpcId</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">vpcid</span> <span class="n">-AvailabilityZone</span> <span class="n">us-west</span><span class="p">-</span><span class="n">2a</span> <span class="n">-CidrBlock</span> <span class="n">10</span><span class="p">.</span><span class="n">233</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">24</span>
</pre></div>


<h4 id="register-public-subnet-to-public-route-table">Register Public Subnet to Public Route Table</h4>
<div class="codehilite"><pre><span></span><span class="nb">Register-EC2RouteTable</span> <span class="n">-RouteTableId</span> <span class="nv">$mainroutetable</span><span class="p">.</span><span class="n">RouteTableId</span> <span class="n">-SubnetId</span> <span class="nv">$pubsub</span><span class="p">.</span><span class="n">SubnetId</span>
</pre></div>


<h4 id="tag-public-subnet">Tag Public Subnet</h4>
<div class="codehilite"><pre><span></span><span class="nv">$pubsubtag</span><span class="p">=</span><span class="nb">New-Object</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">EC2</span><span class="p">.</span><span class="n">Model</span><span class="p">.</span><span class="n">Tag</span>
<span class="nv">$pubsubtag</span><span class="p">.</span><span class="n">Key</span> <span class="p">=</span> <span class="s2">&quot;Name&quot;</span>
<span class="nv">$pubsubtag</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&quot;DEV334-PubSub-1&quot;</span>
<span class="nb">New-EC2Tag</span> <span class="n">-Resource</span> <span class="nv">$pubsub</span><span class="p">.</span><span class="n">subnetid</span> <span class="n">-Tag</span> <span class="nv">$pubsubtag</span>
</pre></div>


<h4 id="create-nat-gateway">Create NAT Gateway</h4>
<blockquote>
<p>But first, create an Elastic IP for it</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="nv">$eipallocation</span> <span class="p">=</span> <span class="nb">New-EC2Address</span> <span class="n">-Domain</span> <span class="n">Vpc</span>
</pre></div>


<h4 id="check-elastic-ip">Check Elastic IP</h4>
<div class="codehilite"><pre><span></span><span class="nv">$eipallocation</span><span class="p">.</span><span class="n">AllocationId</span>
</pre></div>


<h4 id="now-create-nat-gateway">Now Create NAT Gateway</h4>
<div class="codehilite"><pre><span></span><span class="nv">$ngw</span> <span class="p">=</span> <span class="nb">New-EC2NatGateway</span> <span class="n">-SubnetId</span> <span class="nv">$pubsub</span><span class="p">.</span><span class="n">SubnetId</span> <span class="n">-AllocationId</span> <span class="nv">$eipallocation</span><span class="p">.</span><span class="n">AllocationId</span>
</pre></div>


<h4 id="check-status-of-nat-gateway-creation">Check status of NAT Gateway creation</h4>
<blockquote>
<p>Wait for about 3 minutes for the NAT Gateway to be created</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">Get-EC2NatGateway</span> <span class="n">-Filter</span> <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;vpc-id&quot;</span><span class="p">;</span> <span class="n">Value</span> <span class="p">=</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">vpcid</span> <span class="p">}).</span><span class="n">State</span>
</pre></div>


<h4 id="wait-till-the-result-of-this-cmdlet-shows-nat-gateway-as-available">Wait till the result of this cmdlet shows NAT Gateway as Available</h4>
<div class="codehilite"><pre><span></span><span class="nv">$ngwid</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-EC2NatGateway</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-eq</span> <span class="s1">&#39;available&#39;</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">VpcId</span> <span class="o">-eq</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">VpcId</span><span class="p">}).</span><span class="n">NatGatewayId</span>
</pre></div>


<h4 id="create-private-route-table">Create Private Route Table</h4>
<div class="codehilite"><pre><span></span><span class="nv">$prirt</span> <span class="p">=</span> <span class="nb">New-EC2RouteTable</span> <span class="n">-VpcId</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">VpcId</span>
</pre></div>


<h4 id="tag-private-route-table">Tag Private Route Table</h4>
<div class="codehilite"><pre><span></span><span class="nv">$prirttag</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">EC2</span><span class="p">.</span><span class="n">Model</span><span class="p">.</span><span class="n">Tag</span>
<span class="nv">$prirttag</span><span class="p">.</span><span class="n">Key</span> <span class="p">=</span> <span class="s2">&quot;Name&quot;</span>
<span class="nv">$prirttag</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&quot;DEV334-PriRoute-1&quot;</span>
<span class="nb">New-EC2Tag</span> <span class="n">-Resource</span> <span class="nv">$prirt</span><span class="p">.</span><span class="n">RouteTableId</span> <span class="n">-Tag</span> <span class="nv">$prirttag</span>
</pre></div>


<h4 id="route-internet-traffic-through-nat-gateway-for-private-subnet">Route internet traffic through NAT Gateway for Private Subnet</h4>
<div class="codehilite"><pre><span></span><span class="nb">New-EC2Route</span> <span class="n">-RouteTableId</span> <span class="nv">$prirt</span><span class="p">.</span><span class="n">RouteTableId</span> <span class="n">-DestinationCidrBlock</span> <span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">0</span> <span class="n">-GatewayId</span> <span class="nv">$ngwid</span>
</pre></div>


<h4 id="create-private-subnet">Create Private Subnet</h4>
<div class="codehilite"><pre><span></span><span class="nv">$prisub</span> <span class="p">=</span> <span class="nb">New-EC2Subnet</span> <span class="n">-VpcId</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">VpcId</span> <span class="n">-AvailabilityZone</span> <span class="n">us-west</span><span class="p">-</span><span class="n">2a</span> <span class="n">-CidrBlock</span> <span class="n">10</span><span class="p">.</span><span class="n">233</span><span class="p">.</span><span class="n">11</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">24</span>
</pre></div>


<h4 id="tag-private-subnet">Tag Private Subnet</h4>
<div class="codehilite"><pre><span></span><span class="nv">$prisubtag</span><span class="p">=</span><span class="nb">New-Object</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">EC2</span><span class="p">.</span><span class="n">Model</span><span class="p">.</span><span class="n">Tag</span>
<span class="nv">$prisubtag</span><span class="p">.</span><span class="n">Key</span> <span class="p">=</span> <span class="s2">&quot;Name&quot;</span>
<span class="nv">$prisubtag</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&quot;DEV334-PriSub-1&quot;</span>
<span class="nb">New-EC2Tag</span> <span class="n">-Resource</span> <span class="nv">$prisub</span><span class="p">.</span><span class="n">subnetid</span> <span class="n">-Tag</span> <span class="nv">$prisubtag</span>
</pre></div>


<h4 id="register-private-subnet-to-private-route-table">Register Private Subnet to Private Route table</h4>
<div class="codehilite"><pre><span></span><span class="nb">Register-EC2RouteTable</span> <span class="n">-RouteTableId</span> <span class="nv">$prirt</span><span class="p">.</span><span class="n">RouteTableId</span> <span class="n">-SubnetId</span> <span class="nv">$prisub</span><span class="p">.</span><span class="n">SubnetId</span>
</pre></div>


<blockquote>
<p>Next, we are going to create the Security Group for EC2</p>
</blockquote>
<h4 id="define-ports-ingress-ip-range-etc-for-sg">Define Ports, Ingress, IP Range etc for SG</h4>
<div class="codehilite"><pre><span></span><span class="nv">$sgrdp1</span> <span class="p">=</span> <span class="p">@{</span> <span class="n">IpProtocol</span><span class="p">=</span><span class="s2">&quot;tcp&quot;</span><span class="p">;</span> <span class="n">FromPort</span><span class="p">=</span><span class="s2">&quot;3389&quot;</span><span class="p">;</span> <span class="n">ToPort</span><span class="p">=</span><span class="s2">&quot;3389&quot;</span><span class="p">;</span> <span class="n">IpRanges</span><span class="p">=</span><span class="s2">&quot;0.0.0.0/0&quot;</span> <span class="p">}</span>
<span class="nv">$sghttp</span> <span class="p">=</span> <span class="p">@{</span> <span class="n">IpProtocol</span><span class="p">=</span><span class="s2">&quot;tcp&quot;</span><span class="p">;</span> <span class="n">FromPort</span><span class="p">=</span><span class="s2">&quot;80&quot;</span><span class="p">;</span> <span class="n">ToPort</span><span class="p">=</span><span class="s2">&quot;80&quot;</span><span class="p">;</span> <span class="n">IpRanges</span><span class="p">=</span><span class="s2">&quot;0.0.0.0/0&quot;</span> <span class="p">}</span>
</pre></div>


<h4 id="more-ports-for-security-group-if-needed">More Ports for Security Group if needed</h4>
<div class="codehilite"><pre><span></span><span class="nv">$sghttps</span> <span class="p">=</span> <span class="p">@{</span> <span class="n">IpProtocol</span><span class="p">=</span><span class="s2">&quot;tcp&quot;</span><span class="p">;</span> <span class="n">FromPort</span><span class="p">=</span><span class="s2">&quot;443&quot;</span><span class="p">;</span> <span class="n">ToPort</span><span class="p">=</span><span class="s2">&quot;443&quot;</span><span class="p">;</span> <span class="n">IpRanges</span><span class="p">=</span><span class="s2">&quot;0.0.0.0/0&quot;</span> <span class="p">}</span>
</pre></div>


<h4 id="create-sg">Create SG</h4>
<div class="codehilite"><pre><span></span><span class="nb">New-EC2SecurityGroup</span> <span class="n">-GroupName</span> <span class="n">DEV334-win-sg</span><span class="p">-</span><span class="n">1</span> <span class="n">-Description</span> <span class="s2">&quot;SG for Builder Session&quot;</span> <span class="n">-VpcId</span> <span class="nv">$newvpc</span><span class="p">.</span><span class="n">VpcId</span>
</pre></div>


<h4 id="make-sure-security-group-has-been-created">Make sure Security Group has been created</h4>
<blockquote>
<p>If the following cmdlet doesn't return a Group ID, SG was not created as expected. Ask for help.</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">Get-EC2SecurityGroup</span> <span class="n">-Filter</span> <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;group-name&quot;</span><span class="p">;</span> <span class="n">Value</span> <span class="p">=</span> <span class="s2">&quot;DEV334-win-sg-1&quot;</span> <span class="p">}).</span><span class="n">GroupID</span>
</pre></div>


<blockquote>
<p>Store Security Group ID to a variable</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="nv">$newsg</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-EC2SecurityGroup</span> <span class="n">-Filter</span> <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;group-name&quot;</span><span class="p">;</span> <span class="n">Value</span> <span class="p">=</span> <span class="s2">&quot;DEV334-win-sg-1&quot;</span> <span class="p">}).</span><span class="n">GroupID</span>
</pre></div>


<h4 id="grant-ingress-access-in-security-group">Grant ingress access in Security Group</h4>
<div class="codehilite"><pre><span></span><span class="nb">Grant-EC2SecurityGroupIngress</span> <span class="n">-GroupId</span> <span class="nv">$newsg</span> <span class="n">-IpPermission</span> <span class="p">@(</span> <span class="nv">$sghttp</span><span class="p">,</span> <span class="nv">$sgrdp1</span> <span class="p">)</span>
</pre></div>


<h4 id="grant-egress-access-in-sg-allow-all-to-keep-it-stateful">Grant egress access in SG (allow-all to keep it stateful)</h4>
<blockquote>
<p>When SG is created, it automatically allows all egress access. This is what makes a security group stateful. You can edit it to make it more restrictive or stateful for fewer ports and IP ranges, if needed.</p>
</blockquote>
<h4 id="create-pem-key-for-ec2">Create PEM key for EC2</h4>
<blockquote>
<p>Mac users, change the .pem file path to an appropriate location</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">New-EC2KeyPair</span> <span class="n">-KeyName</span> <span class="s2">&quot;DEV334-builder-session-key&quot;</span><span class="p">).</span><span class="n">KeyMaterial</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">C</span><span class="err">:</span><span class="p">\</span><span class="n">DEV334-builder-session-key</span><span class="p">.</span><span class="n">pem</span>
</pre></div>


<h4 id="create-windows-2016-ec2-instance">Create Windows 2016 EC2 instance</h4>
<blockquote>
<p>Use this AMI for EC2</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="nv">$ami</span> <span class="p">=</span> <span class="nb">Get-EC2ImageByName</span> <span class="n">WINDOWS_2016_BASE</span>
</pre></div>


<blockquote>
<p>Check if you have an AMI with above name. If the result is empty, AMI with the specified name doesn't exist. Ask for help.</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="nv">$ami</span><span class="p">.</span><span class="n">ImageId</span>
</pre></div>


<h4 id="create-tag-for-ec2">Create Tag for EC2</h4>
<div class="codehilite"><pre><span></span><span class="nv">$ec2tag1</span> <span class="p">=</span> <span class="p">@{</span> <span class="n">Key</span><span class="p">=</span><span class="s2">&quot;Name&quot;</span><span class="p">;</span> <span class="n">Value</span><span class="p">=</span><span class="s2">&quot;Win-2016-With-IIS&quot;</span> <span class="p">}</span>
<span class="nv">$ec2tagspec</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">EC2</span><span class="p">.</span><span class="n">Model</span><span class="p">.</span><span class="n">TagSpecification</span>
<span class="nv">$ec2tagspec</span><span class="p">.</span><span class="n">ResourceType</span> <span class="p">=</span> <span class="s2">&quot;instance&quot;</span>
<span class="nv">$ec2tagspec</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$ec2tag1</span><span class="p">)</span>
<span class="nb">New-EC2Tag</span> <span class="n">-Resource</span> <span class="nv">$ami</span><span class="p">.</span><span class="n">ImageId</span> <span class="n">-Tag</span> <span class="nv">$ec2tag1</span>
</pre></div>


<h4 id="auto-assign-ipv4-since-we-need-a-public-ip-to-log-into-ec2">Auto assign IPv4 since we need a public IP to log into EC2</h4>
<div class="codehilite"><pre><span></span><span class="nb">Edit-EC2SubnetAttribute</span> <span class="n">-SubnetId</span> <span class="nv">$pubsub</span><span class="p">.</span><span class="n">SubnetId</span> <span class="n">-MapPublicIpOnLaunch</span> <span class="nv">$true</span>
</pre></div>


<h4 id="setup-iis-and-the-sample-website">Setup IIS and the sample website</h4>
<blockquote>
<p>Copy the following script to a text file on your laptop and save it as IISConfig.txt</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="n">powershell</span><span class="p">&gt;</span>
<span class="nb">Set-ExecutionPolicy</span> <span class="n">Bypass</span> <span class="n">-Scope</span> <span class="k">Process</span> <span class="n">-Force</span>

<span class="c"># Save machine name for messages</span>
<span class="no">[string]</span><span class="nv">$vm</span> <span class="p">=</span> <span class="nv">$Env:Computername</span>

<span class="c"># Check for IIS presence and installo, if needed</span>
<span class="k">if</span> <span class="p">((</span><span class="nb">Get-WindowsFeature</span> <span class="n">Web-Server</span><span class="p">).</span><span class="n">InstallState</span> <span class="o">-ne</span> <span class="s2">&quot;Installed&quot;</span><span class="p">)</span> 
    <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;IIS is not installed on $vm - installing&quot;</span>
    <span class="nb">Install-WindowsFeature</span> <span class="n">web-server</span> <span class="n">-IncludeManagementTools</span>
    <span class="p">}</span> 
 <span class="nb">Write-Host</span> <span class="s2">&quot;IIS is  installed on $vm&quot;</span>

 <span class="c"># Remove files of the default web site</span>
<span class="nb">Remove-Item</span> <span class="s2">&quot;C:/inetpub/wwwroot/*.*&quot;</span>

<span class="c"># New HTML file defined as hash table inside the script</span>
<span class="c"># (in real life we would probably copy site from some bucket or share)</span>
<span class="nv">$Page</span> <span class="p">=</span>
       <span class="p">@(</span>
        <span class="s1">&#39; &lt;html&gt;</span>
<span class="s1">&lt;h1 style=&quot;font-size: 75px;font-family: Arial, Helvetica, sans-serif; text-align: center;&quot; &gt;Congratulations!&lt;/h1&gt;</span>
<span class="s1">&lt;h2 style=&quot;font-size: 25px;font-family: Arial, Helvetica, sans-serif; text-align: center&quot; &gt;You have successfully completed the exercise DEV334 - Powershell tools for AWS&lt;/h2&gt;</span>
<span class="s1">&lt;svg style=&quot;width:100%;height:700px;&quot;&gt;</span>
<span class="s1">    &lt;path class=&quot;path&quot; fill=&quot;none&quot; stroke=&quot;orange&quot; stroke-width=&quot;5&quot; stroke-miterlimit=&quot;10&quot; d=&quot;M989,595H712v-35c0,0,4.5-1.8,8-3</span>
<span class="s1">                                                                                                  c5.2-1.8,12.5,5.3,22-4c3.4-3.4-0.9-7.8-0.4-10.1c0.7-3.1,4.4-6.8,1.6-11.4c-2.6-4.2-6.9-3.6-8.2-5.5c-1.7-2.3-2.2-6.3-7-9</span>
<span class="s1">                                                                                                  c-5.6-3.1-9.9,0.2-13-1c-2.5-0.9-2.3-5-9-5c-4.8,0-7.2,4.8-10,5c-2.3,0.2-4.9-4.5-10-2c-5.5,2.8-4,7.3-6,9c-1.4,1.2-3.1,3.2-6,4.2</span>
<span class="s1">                                                                                                  c-2.6,0.9-4.9,3-4,8.8c0.6,3.7,6.8,4.1,7.5,6c1,2.9-6.4,6.2-2.5,12c3,4.5,9,1.6,12,1c1.9-0.4,7.1-0.7,8,0c3.4,2.5,9,5,9,5v35</span>
<span class="s1">                                                                                                  l-506-1.5L182.3,444l0.3-0.8v-69.6l-0.2-0.2l12.3-72.3c10.9-2.6,16.5-6.5,16.5-6.5l-5.2-2.9l1.1-5.8l15-3.3l-10.1-3.9l1.2-4.6</span>
<span class="s1">                                                                                                  c-15.8-8.3-32.2-11-32.2-11v-3.6l4.1-6.5h-4.9v-4.4h-8.3V244h-1.2l-1.7-31.2l-1-1.3l-1,1.3l-1.7,31.2h-1.2v4.8h-8.3v4.4h-4.9</span>
<span class="s1">                                                                                                  l4.1,6.5v3.6c0,0-16.5,2.7-32.2,11l1.2,4.6l-10.1,3.9l15,3.3l1.1,5.8l-5.1,2.9c0,0,5.5,3.9,16.4,6.5l12.3,72.4l-0.1,0.1v69.6</span>
<span class="s1">                                                                                                  l0.3,0.8l-14.6,149.4h-1.2H-11&quot; /&gt;</span>

<span class="s1">    &lt;path class=&quot;path&quot; fill=&quot;grey&quot; stroke=&quot;orange&quot; stroke-width=&quot;2&quot; stroke-miterlimit=&quot;10&quot; d=&quot;M8,393.7c0-13.5,12.1-10.8,15.6-14.7</span>
<span class="s1">                                                                                                  c2.8-3.2-1-8.8,9-13.9c7.9-4.1,9.7,1,13.1,0.8c4.5-0.3,3.3-6.7,14.7-6.6c12.7,0.2,11.2,8.4,14.7,10.6c3,1.9,7.9-2.1,13.9,4.1</span>
<span class="s1">                                                                                                  c3.8,4,1.3,7.4,2.5,9.8c2.2,4.4,14.7,0.9,14.7,13.9c0,12.2-13.5,8.3-17.2,10.6c-3.6,2.3-4.4,9.3-13.1,11.5c-8,2-9.5-4-13.9-4.1</span>
<span class="s1">                                                                                                  c-5-0.1-5.5,8.6-18.8,6.6c-12.3-1.9-12.3-9.1-16.4-12.3C21.9,406.3,8,408.6,8,393.7z&quot; /&gt;</span>


<span class="s1">    &lt;path class=&quot;path&quot; fill=&quot;lightgrey&quot; stroke=&quot;orange&quot; stroke-width=&quot;2&quot; stroke-miterlimit=&quot;10&quot; d=&quot;M325.1,313.9c-3.9,3-3.9,10-15.7,11.8</span>
<span class="s1">                                                                                                  c-12.8,2-13.3-6.4-18-6.3c-4.3,0.1-5.7,5.8-13.3,3.9c-8.4-2.1-9.1-8.8-12.5-11c-3.6-2.3-16.5,1.5-16.5-10.2c0-12.4,12-9.1,14.1-13.3</span>
<span class="s1">                                                                                                  c1.1-2.3-1.3-5.6,2.4-9.4c5.8-6,10.4-2.1,13.3-3.9c3.4-2.1,2-10,14.1-10.2c11-0.2,9.9,6,14.1,6.3c3.3,0.2,5-4.7,12.5-0.8</span>
<span class="s1">                                                                                                  c9.6,4.9,6,10.3,8.6,13.3c3.3,3.7,14.9,1.2,14.9,14.1C343.1,312.5,329.8,310.3,325.1,313.9z&quot; /&gt;</span>

<span class="s1">    &lt;path class=&quot;path&quot; fill=&quot;lightgrey&quot; stroke=&quot;orange&quot; stroke-width=&quot;2&quot; stroke-miterlimit=&quot;10&quot; d=&quot;M18.4,229.5c0-13.5,12.1-10.8,15.6-14.7</span>
<span class="s1">                                                                                                  c2.8-3.2-1-8.8,9-13.9c7.9-4.1,9.7,1,13.1,0.8c4.5-0.3,3.3-6.7,14.7-6.6c12.7,0.2,11.2,8.4,14.7,10.6c3,1.9,7.9-2.1,13.9,4.1</span>
<span class="s1">                                                                                                  c3.8,4,1.3,7.4,2.5,9.8c2.2,4.4,14.7,0.9,14.7,13.9c0,12.2-13.5,8.3-17.2,10.6c-3.6,2.3-4.4,9.3-13.1,11.5c-8,2-9.5-4-13.9-4.1</span>
<span class="s1">                                                                                                  c-5-0.1-5.5,8.6-18.8,6.6c-12.3-1.9-12.3-9.1-16.4-12.3C32.2,242.1,18.4,244.4,18.4,229.5z&quot; /&gt;</span>

<span class="s1">    &lt;path class=&quot;path&quot; fill=&quot;grey&quot; stroke=&quot;orange&quot; stroke-width=&quot;2&quot; stroke-miterlimit=&quot;10&quot; d=&quot;M215.8,398.8c0-13.5,12.1-10.8,15.6-14.7</span>
<span class="s1">                                                                                                  c2.8-3.2-1-8.8,9-13.9c7.9-4.1,9.7,1,13.1,0.8c4.5-0.3,3.3-6.7,14.7-6.6c12.7,0.2,11.2,8.4,14.7,10.6c3,1.9,7.9-2.1,13.9,4.1</span>
<span class="s1">                                                                                                  c3.8,4,1.3,7.4,2.5,9.8c2.2,4.4,14.7,0.9,14.7,13.9c0,12.2-13.5,8.3-17.2,10.6c-3.6,2.3-4.4,9.3-13.1,11.5c-8,2-9.5-4-13.9-4.1</span>
<span class="s1">                                                                                                  c-5-0.1-5.5,8.6-18.8,6.6c-12.3-1.9-12.3-9.1-16.4-12.3C229.7,411.3,215.8,413.6,215.8,398.8z&quot; /&gt;</span>

<span class="s1">&lt;/svg&gt; </span>
<span class="s1">&lt;/html&gt;&#39;</span>
        <span class="p">)</span>
<span class="nb">Set-Content</span> <span class="s2">&quot;C:/inetpub/wwwroot/Index.html&quot;</span> <span class="n">-Value</span> <span class="nv">$Page</span>
<span class="p">&lt;/</span><span class="n">powershell</span><span class="p">&gt;</span>
</pre></div>


<h4 id="create-windows-ec2-instance">Create Windows EC2 instance</h4>
<blockquote>
<p>Make sure you give the correct local path of the IISConfig.txt file you created in the above step</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="nv">$script</span> <span class="p">=</span> <span class="nb">Get-Content</span> <span class="n">-Raw</span> <span class="n">C</span><span class="err">:</span><span class="p">\&lt;</span><span class="n">Path</span><span class="p">&gt;\</span><span class="n">IISConfig</span><span class="p">.</span><span class="n">txt</span>
<span class="nv">$userdata</span> <span class="p">=</span> <span class="no">[System.Convert]</span><span class="p">::</span><span class="n">ToBase64String</span><span class="p">(</span><span class="no">[System.Text.Encoding]</span><span class="p">::</span><span class="n">ASCII</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="nv">$Script</span><span class="p">))</span>
</pre></div>


<h4 id="create-ec2-instance-and-pass-ps-userdata-file-to-install-iis">Create EC2 instance and pass PS Userdata file to Install IIS</h4>
<div class="codehilite"><pre><span></span><span class="nb">New-EC2Instance</span> <span class="n">-ImageId</span> <span class="nv">$ami</span><span class="p">.</span><span class="n">ImageId</span> <span class="n">-InstanceType</span> <span class="n">t2</span><span class="p">.</span><span class="n">large</span> <span class="n">-SubnetId</span> <span class="nv">$pubsub</span><span class="p">.</span><span class="n">SubnetId</span> <span class="n">-KeyName</span> <span class="n">DEV334-builder-session-key</span> <span class="n">-SecurityGroupId</span> <span class="nv">$newsg</span> <span class="n">-UserData</span> <span class="nv">$userdata</span> <span class="n">-Tagspecification</span> <span class="nv">$ec2tagspec</span>
</pre></div>


<h4 id="get-ip-address-of-the-newly-created-ec2-instance">Get IP address of the newly created EC2 instance</h4>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">Get-EC2Instance</span> <span class="n">-Filter</span> <span class="p">@{</span><span class="n">Name</span><span class="p">=</span><span class="s2">&quot;vpc-id&quot;</span><span class="p">;</span><span class="n">Value</span><span class="p">=</span><span class="nv">$vpcid</span><span class="p">}).</span><span class="n">Instances</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-Property</span> <span class="n">PublicIpAddress</span>
</pre></div>


<h4 id="test-the-website">Test the website</h4>
<blockquote>
<p>It takes about 5 minutes for the EC2 Windows instance to be created.</p>
</blockquote>
<p>Open your browser on the local machine and navigate to http://<Public IP of EC2></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../resources/" title="Resources" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Resources
              </span>
            </div>
          </a>
        
        
          <a href="../../../reinvent2019/index2019/" title="Directory" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Directory
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://awsentworkshops.com" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/windows/" class="md-footer-social__link fa fa-globe"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.dc02f8ce.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../javascripts/extra.js"></script>
      
    
  </body>
</html>