



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A collection of Windows on AWS workshops">
      
      
        <link rel="canonical" href="https://awsentworkshops.com/reinvent2018/win313/fargate/">
      
      
        <meta name="author" content="aws-ent-workshops@amazon.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.1">
    
    
      
        <title>Amazon ECS Fargate - Windows on AWS Workshops</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.3020aac5.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#deploy-a-net-core-application-on-amazon-ecs-fargate-using-azure-devops-vsts" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../../../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Windows on AWS Workshops
                </span>
                <span class="md-header-nav__topic">
                  Amazon ECS Fargate
                </span>
              
            
          </div>
        </div>
  
        <!-- Button to open search dialogue -->
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              <!-- Search interface -->
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>
        
        <!-- Repository containing source -->
        
        <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__lang">
                <div class="md-lang-drop">
                    <button onmouseover="langToggle()" class="md-lang-dropbtn fa fa-globe"></button>
                </div>
            </div>
        </div>

        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/aws-samples/aws-workshop-for-win-dotnet-mssql/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/aws-workshop-for-win-dotnet-mssql
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../index2018/" title="re:Invent 2018" class="md-tabs__link md-tabs__link--active">
          re:Invent 2018
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../reinvent2019/index2019/" title="re:Invent 2019" class="md-tabs__link">
          re:Invent 2019
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../builder-sessions/" title="Builder Sessions" class="md-tabs__link">
          Builder Sessions
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../workshops/" title="Full Day Workshops" class="md-tabs__link">
          Full Day Workshops
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://awsentworkshops.com" title="Windows on AWS Workshops" class="md-nav__button md-logo">
      
        <img src="../../../assets/images/aws_smile_logo.png" width="48" height="48">
      
    </a>
    Windows on AWS Workshops
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/aws-samples/aws-workshop-for-win-dotnet-mssql/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/aws-workshop-for-win-dotnet-mssql
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      re:Invent 2018
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        re:Invent 2018
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../index2018/" title="Directory" class="md-nav__link">
      Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Win319
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Win319
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/win319index/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/prereq/" title="Pre-Requisite" class="md-nav__link">
      Pre-Requisite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/1_DeployAd/" title="Create Directory" class="md-nav__link">
      Create Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/2_DeployMad/" title="Deploy Managed AD" class="md-nav__link">
      Deploy Managed AD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/3_Trust/" title="Create Domain Trust" class="md-nav__link">
      Create Domain Trust
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/4_Createorg/" title="Create AWS Organization" class="md-nav__link">
      Create AWS Organization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/5_ConnectADtoSSO/" title="Connect AD to SSO" class="md-nav__link">
      Connect AD to SSO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win319/6_VerifyADSSO_MAD/" title="Verify SSO" class="md-nav__link">
      Verify SSO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3" checked>
    
    <label class="md-nav__link" for="nav-3-3">
      Win313
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Win313
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../win313index/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-3" type="checkbox" id="nav-3-3-3" checked>
    
    <label class="md-nav__link" for="nav-3-3-3">
      Challenges
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-3">
        Challenges
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ec2/" title="Amazon EC2" class="md-nav__link">
      Amazon EC2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lambda/" title="AWS Lambda" class="md-nav__link">
      AWS Lambda
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Amazon ECS Fargate
      </label>
    
    <a href="./" title="Amazon ECS Fargate" class="md-nav__link md-nav__link--active">
      Amazon ECS Fargate
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-setup" title="Environment Setup" class="md-nav__link">
    Environment Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-iam-user-for-azure-devops" title="Create a new IAM User for Azure DevOps" class="md-nav__link">
    Create a new IAM User for Azure DevOps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-aws-tools-for-vsts-aka-azure-devops" title="Install AWS Tools for VSTS aka Azure DevOps" class="md-nav__link">
    Install AWS Tools for VSTS aka Azure DevOps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-sample-application-code-create-azure-devops-project" title="Import Sample Application code &amp; Create Azure DevOps project" class="md-nav__link">
    Import Sample Application code &amp; Create Azure DevOps project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-aws-service-connection-for-azure-devops-project" title="Setup AWS Service Connection for Azure DevOps project" class="md-nav__link">
    Setup AWS Service Connection for Azure DevOps project
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-azure-devops-build-pipeline" title="Create Azure DevOps Build pipeline" class="md-nav__link">
    Create Azure DevOps Build pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-target-amazon-ecs-environment-to-deploy-application" title="Build target Amazon ECS environment to deploy application" class="md-nav__link">
    Build target Amazon ECS environment to deploy application
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws-region-selection" title="AWS Region Selection" class="md-nav__link">
    AWS Region Selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-amazon-ecs-task-definition" title="Create Amazon ECS Task Definition" class="md-nav__link">
    Create Amazon ECS Task Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-amazon-ecs-cluster" title="Create Amazon ECS Cluster" class="md-nav__link">
    Create Amazon ECS Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-amazon-ecs-service" title="Create Amazon ECS Service" class="md-nav__link">
    Create Amazon ECS Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-new-azure-devops-release-pipeline" title="Create a new Azure DevOps Release pipeline" class="md-nav__link">
    Create a new Azure DevOps Release pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-application-to-amazon-ecs-fargate-validate" title="Deploy application to Amazon ECS Fargate &amp; validate" class="md-nav__link">
    Deploy application to Amazon ECS Fargate &amp; validate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-steps" title="Final Steps" class="md-nav__link">
    Final Steps
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Win308
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Win308
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win308/win308index/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win308/prereq/" title="Pre-requisites" class="md-nav__link">
      Pre-requisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-3" type="checkbox" id="nav-3-4-3">
    
    <label class="md-nav__link" for="nav-3-4-3">
      Challenges
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-3">
        Challenges
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win308/challenge1/" title="Challenge 1 Configuring resources using AWS Tools for Windows PowerShell" class="md-nav__link">
      Challenge 1 Configuring resources using AWS Tools for Windows PowerShell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win308/challenge2/" title="Challenge 2 Configure EC2 instances using Powershell and SSM" class="md-nav__link">
      Challenge 2 Configure EC2 instances using Powershell and SSM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      Win309
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        Win309
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win309/win309index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win309/prereq/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win309/resources/" title="Lab Guide" class="md-nav__link">
      Lab Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">
    
    <label class="md-nav__link" for="nav-3-6">
      Win314
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        Win314
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win314/win314index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win314/build/" title="Let's Build" class="md-nav__link">
      Let's Build
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Win310
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Win310
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/win310index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/scenario/" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/rehost/" title="Rehost" class="md-nav__link">
      Rehost
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/replatform/" title="Replatform" class="md-nav__link">
      Replatform
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/refactor/" title="Refactor" class="md-nav__link">
      Refactor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../win310/bonus/" title="Bonus" class="md-nav__link">
      Bonus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      Dev334
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        Dev334
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev334/dev334index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev334/prereq/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev334/resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8-4" type="checkbox" id="nav-3-8-4">
    
    <label class="md-nav__link" for="nav-3-8-4">
      Challenges
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-8-4">
        Challenges
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev334/challenge1/" title="Powershell exercise" class="md-nav__link">
      Powershell exercise
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      re:Invent 2019
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        re:Invent 2019
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reinvent2019/index2019/" title="Directory" class="md-nav__link">
      Directory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Builder Sessions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Builder Sessions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../builder-sessions/" title="Directory" class="md-nav__link">
      Directory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Full Day Workshops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Full Day Workshops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../workshops/" title="Directory" class="md-nav__link">
      Directory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-setup" title="Environment Setup" class="md-nav__link">
    Environment Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-iam-user-for-azure-devops" title="Create a new IAM User for Azure DevOps" class="md-nav__link">
    Create a new IAM User for Azure DevOps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-aws-tools-for-vsts-aka-azure-devops" title="Install AWS Tools for VSTS aka Azure DevOps" class="md-nav__link">
    Install AWS Tools for VSTS aka Azure DevOps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-sample-application-code-create-azure-devops-project" title="Import Sample Application code &amp; Create Azure DevOps project" class="md-nav__link">
    Import Sample Application code &amp; Create Azure DevOps project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-aws-service-connection-for-azure-devops-project" title="Setup AWS Service Connection for Azure DevOps project" class="md-nav__link">
    Setup AWS Service Connection for Azure DevOps project
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-azure-devops-build-pipeline" title="Create Azure DevOps Build pipeline" class="md-nav__link">
    Create Azure DevOps Build pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-target-amazon-ecs-environment-to-deploy-application" title="Build target Amazon ECS environment to deploy application" class="md-nav__link">
    Build target Amazon ECS environment to deploy application
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws-region-selection" title="AWS Region Selection" class="md-nav__link">
    AWS Region Selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-amazon-ecs-task-definition" title="Create Amazon ECS Task Definition" class="md-nav__link">
    Create Amazon ECS Task Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-amazon-ecs-cluster" title="Create Amazon ECS Cluster" class="md-nav__link">
    Create Amazon ECS Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-amazon-ecs-service" title="Create Amazon ECS Service" class="md-nav__link">
    Create Amazon ECS Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-new-azure-devops-release-pipeline" title="Create a new Azure DevOps Release pipeline" class="md-nav__link">
    Create a new Azure DevOps Release pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-application-to-amazon-ecs-fargate-validate" title="Deploy application to Amazon ECS Fargate &amp; validate" class="md-nav__link">
    Deploy application to Amazon ECS Fargate &amp; validate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-steps" title="Final Steps" class="md-nav__link">
    Final Steps
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-workshop-for-win-dotnet-mssql/edit/master/docs/reinvent2018/win313/fargate.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="deploy-a-net-core-application-on-amazon-ecs-fargate-using-azure-devops-vsts">Deploy a .Net Core application on Amazon ECS Fargate using Azure DevOps (VSTS)</h1>
<blockquote>
<p>In this lab we will create a CICD pipeline on Azure DevOps using AWS Tools for VSTS.</p>
</blockquote>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Complete the <a href="../setup/">Lab Setup</a>.</li>
<li>Validate access to the sample source code repository in Github by browsing to this url <a href="https://github.com/awsimaya/ECSFargate.git">https://github.com/awsimaya/ECSFargate.git</a> .</li>
<li>It is necessary to follow the instructions carefully to ensure successful completion of the lab.</li>
</ul>
<h2 id="environment-setup">Environment Setup</h2>
<blockquote>
<p>In this section we will configure the environment baseline to get started.</p>
</blockquote>
<h3 id="create-a-new-iam-user-for-azure-devops">Create a new IAM User for Azure DevOps</h3>
<blockquote>
<p>In this section, we will create a new IAM user account that will be used by your Azure DevOps service to deploy resources in your AWS Account.</p>
</blockquote>
<ul>
<li>If you already have Access Key ID and Secret Access Key of an IAM User account to be used with Azure DevOps then you can skip this section.</li>
<li>Click on IAM Service</li>
<li>In the navigation pane, choose <strong>Users</strong> and then choose <strong>Add user</strong>.</li>
<li>Type the user name for the new user. This is the sign-in name for AWS.</li>
<li>Select only programmatic access. This creates an access key for each new user. You can view or download the access keys when you get to the Final page.</li>
<li>Click on <strong>Next: Permissions</strong>.</li>
<li>Select Attach existing policies directly.</li>
<li>
<p>Select Administrator Access.</p>
<blockquote>
<p>Note: This is not a best practice to provide Administrator Access. Its recommended to follow least access privilege and limit permissions to the resources that would be required from AzureDevOps account. This could vary depending upon your use case and scenarios. Example you may chose to create different IAM User account for Non-Prod Vs Prod and appropriately provide the  necessary permissions following least access privilege principle.</p>
</blockquote>
</li>
<li>
<p>Click on <strong>Next: Review</strong></p>
</li>
<li>Review the settings and Click on <strong>Create User</strong>.</li>
<li>Save the <strong>Secret Access Key</strong> and <strong>Access Key ID</strong> to be used later in this lab.</li>
</ul>
<h3 id="install-aws-tools-for-vsts-aka-azure-devops">Install AWS Tools for VSTS aka Azure DevOps</h3>
<blockquote>
<p>In this step, we will install AWS Tools for Azure DevOps aka Visual Studio Team Services (VSTS) to your account. This will allow us to leverage the powerful features that this add-on provides to create CICD tasks on AWS</p>
</blockquote>
<ul>
<li>Login to your Azure DevOps (formerly VSTS) account</li>
<li>Navigate to <a href="https://marketplace.visualstudio.com/items?itemName=AmazonWebServices.aws-vsts-tools">Visual Studio Marketplace</a> and click on <strong>Get it free</strong> button as shown in the image below
<img alt="" src="../images/fargate/image001.png" /></li>
<li>If you're logged in to Azure DevOps already, you will be taken to your Azure DevOps account where you can select the Organization as shown below.
<img alt="choose" src="../images/fargate/image003.png" /></li>
<li>Once you click, AWS Tools for VSTS will be installed on the organization successfully. You will screen like the below if the the process was successful. Click <strong>Proceed to organization</strong>
<img alt="" src="../images/fargate/image005.png" /></li>
</ul>
<h3 id="import-sample-application-code-create-azure-devops-project">Import Sample Application code &amp; Create Azure DevOps project</h3>
<blockquote>
<p>In this step, we will clone an existing sample .Net Core Application code available in a public Github repository to Azure DevOps Git repository. We will be deploying this application code to Amazon ECS Fargate environment.</p>
</blockquote>
<ul>
<li>On your Azure DevOps home page, go ahead and create a project. Use default settings.</li>
<li>You can create a new Azure DevOps project and/or repository to start from scratch.</li>
<li>To create new project, go to home page in Azure DevOps and select <strong>+ Create Project</strong>. To create new repository in existing project, you can select the <strong>Import repository</strong> from the Repos screen by providing the sample application code's Github repository link <a href="https://github.com/awsimaya/ECSFargate.git">https://github.com/awsimaya/ECSFargate.git</a>. Now Azure DevOps will clone the project from GitHub into its own git repo.</li>
<li>if you already have a project created, then navigate to <strong>Repos</strong> page on the left navigation section. The screen should look similar to this below
<img alt="" src="../images/fargate/image009.png" /></li>
<li>Click on <strong>Import</strong> under <strong>or Import a repository</strong></li>
<li>Enter the Github URL <a href="https://github.com/awsimaya/ECSFargate.git">https://github.com/awsimaya/ECSFargate.git</a>. Click <strong>Import</strong>.</li>
<li>Now Azure DevOps will clone the project from GitHub into its own git repo.
<img alt="" src="../images/fargate/gitimport.png" /></li>
</ul>
<h3 id="setup-aws-service-connection-for-azure-devops-project">Setup AWS Service Connection for Azure DevOps project</h3>
<blockquote>
<p>In this step, we will create a service connection to AWS on Azure DevOps. This will allow us to easily execute AWS specific tasks by simply selecting the service connection within the task itself. If you already have this configured in your Azure DevOps account then you can skip this step and go to next step.</p>
</blockquote>
<ul>
<li>Under Azure DevOps Project Settings &gt; Service connections, click on <strong>New Service connections</strong> and select <strong>AWS</strong> from that list</li>
<li>You will see a window similar to the screenshot below. Give a connection name, enter the Access Key Id and Secret Access Key of the IAM User Account to be used by Azure DevOps. Click <strong>OK</strong>
<img alt="" src="../images/fargate/image015.png" /></li>
<li>You will see a screen like the one below once this process is complete
<img alt="" src="../images/fargate/image017.png" /></li>
</ul>
<h2 id="create-azure-devops-build-pipeline">Create Azure DevOps Build pipeline</h2>
<blockquote>
<p>In this section, we will configure build and release pipelines on Azure DevOps environment using tasks from AWS Tools for VSTS. We will build a docker container image that contains our application and also push it to AWS Elastic Container Repository.</p>
</blockquote>
<ul>
<li>Under <strong>Pipelines</strong>, click <strong>Builds</strong> . On this page, click <strong>New Pipeline</strong></li>
<li>Your page should look like the one below. Click <strong>Use the visual designer</strong> link under <strong>Where is your code?</strong> section
<img alt="" src="../images/fargate/image021.jpg" /></li>
<li>In the next step, select the repo you want to connect to.</li>
<li>Click <strong>Continue</strong>.</li>
<li>On the <strong>Select a template</strong> screen, select <strong>Empty Job</strong> as shown in the screenshot below and click <strong>Apply</strong>
<img alt="" src="../images/fargate/image024.png" /></li>
<li>Now you should be on the <strong>Tasks</strong> tab inside the Build pipeline. Here, to the right hand side for the drop down <strong>Agent Pool</strong> under <strong>Agent job</strong>, select <code>Hosted Ubuntu 1604</code>. More information on Microsoft-hosted agents in Azure DevOps can be found <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=vsts&amp;tabs=yaml">here</a>.</li>
<li>Leave other fields to their default values.</li>
<li>Add a task by click on the <strong>+</strong> sign next to <strong>Agent job 1</strong> on the left hand side. Type <strong>Command</strong> on the search bar on the right hand side. You should see the <strong>Command Line</strong> task as shown below and click <strong>Add</strong>.
<img alt="" src="../images/fargate/image029.png" /></li>
<li>
<p>Once added, name the task <strong>Build Docker Image</strong> and enter the command <code>docker build -t hellofargate ./HelloFargate</code> in the <strong>Script</strong> field as shown below.
<img alt="" src="../images/fargate/image031.png" /></p>
<blockquote>
<p>This command will tag the resulting docker image with <em>'hellofargate'</em> (case sensitive) and provides <em>HelloFargate</em> folder in the repository as the build context (path to the Dockerfile). Syntax of the command is <code>docker build [OPTIONS] PATH | URL | -</code>. More details on docker build command can be found <a href="https://docs.docker.com/engine/reference/commandline/build/">here</a>.</p>
</blockquote>
</li>
<li>
<p>Once again click on the + symbol next to  <strong>Agent job 1</strong>. Type <em>aws</em> on the search field which will list all <strong>AWS</strong> tasks.</p>
</li>
<li>Select <code>AWS Elastic Container Registry Push</code> task and click <strong>Add</strong></li>
<li>Name the image <code>Push Image to ECR</code>. Select the name of the AWS Credentials you setup earlier under <strong>AWS Credentials</strong> drop down. Select <em>EU (Ireland) [eu-west-1]</em> as Region. Select <em>Image name with optional tag</em> for Image identity field. Enter <code>hellofargate</code> for the <strong>Source Image Name</strong> field. Enter <code>latest</code> for <strong>Source Image tag</strong> field. Enter <code>hellofargaterepo</code> for the <strong>Target Repository Name</strong> field (or if you named your ECR repository differently then use that name). Enter <code>latest</code> for the <strong>Target Repository Tag</strong> field. Now click on <strong>Save pipeline</strong> to save your changes. The screenshot below shows all the settings for easier understanding.</li>
<li>
<p>Its important to select the checkbox at the bottom <strong>Create repository if it does not exist</strong>
<img alt="" src="../images/fargate/push-image-to-ecr-with-create-new-ecr-repo.png" /></p>
</li>
<li>
<p>You can rename the build pipeline by just clicking on <code>HelloFargate-CI</code> at the top and typing a name as shown below
<img alt="" src="../images/fargate/image040.png" /></p>
</li>
<li>
<p>Click on <strong>Save and Queue</strong> to save the build pipeline configurations and also queue a build.</p>
<blockquote>
<p>It might take around 2 minutes or so for the image to be published to the repository. Go ahead and start the next step (<em>Create Amazon ECS Task Definition</em>) till this gets completed.</p>
</blockquote>
</li>
<li>
<p>Go to the AWS ECS console, browse to the Amazon ECR section and click on <strong>hellofargaterepo</strong> repository and make sure there is a new entry and the <strong>Pushed at</strong> column reflects the latest timestamp
<img alt="" src="../images/fargate/ecr-repo-image-push-validate.png" /></p>
</li>
</ul>
<h2 id="build-target-amazon-ecs-environment-to-deploy-application">Build target Amazon ECS environment to deploy application</h2>
<blockquote>
<p>In this section, we will first create the target AWS environment where the application code will be deployed, and then configure steps in Azure DevOps to configure automated deployment to this target AWS infrastructure.</p>
</blockquote>
<h3 id="aws-region-selection">AWS Region Selection</h3>
<ul>
<li>Login to AWS Console using an IAM identity which has admin privileges.</li>
<li>Set the AWS region we are going to work on  <em>EU-WEST-1 (Ireland)</em>. See picture below and ensure your setup is set right.
<img alt="" src="../images/fargate/region.png" /></li>
</ul>
<h3 id="create-amazon-ecs-task-definition">Create Amazon ECS Task Definition</h3>
<blockquote>
<p>In this step, we are going to create a Amazon Elastic Container Service <em>Task Definition</em> that will be used to create the container instances in the cluster. A task definition is the core resource within ECS. This is where you define which container images to run, CPU/Memory, ports, commands etc.</p>
</blockquote>
<ul>
<li>Navigate to Elastic Container Service home page</li>
<li>Go to <strong>Repositories</strong> under <strong>Amazon ECR</strong> and click on the <strong>hellofargaterepo</strong> repository</li>
<li>Select the value of <strong>Repository URI</strong> and press <strong>Ctrl+C</strong> or <strong>Cmd+C</strong> if you're using a Mac. You will need this in the next step</li>
<li>Select <strong>Task Definitions</strong> and click on <strong>Create new Task Definition</strong></li>
<li>On the next screen, select <strong>FARGATE</strong> launch type and click <strong>Next</strong></li>
<li>On the next screen, give the Task Definition a name. For this exercise we will call it <code>MyNextTaskDefinition</code>.</li>
<li>Leave <strong>Task Role</strong> and <strong>Network Mode</strong> fields to their default values.</li>
<li>Select <code>0.5 GB</code> for Task memory and <code>0.25 vCPU</code> for Task CPU dropdowns respectively</li>
<li>Your screen should look similar to the one below
<img alt="" src="../images/fargate/image087.png" /></li>
<li>Click <strong>Add Container</strong></li>
<li>Name the container as <code>hellofargatecontainer</code></li>
<li>Copy and paste the Repository URL from ECR and paste into <strong>Image</strong> textbox. Make sure you add the tag <code>:latest</code> to the end of the string. Ensure there are no white spaces at the end.</li>
<li>Ignore the <strong>Private repository authentication</strong> and <strong>Memory Limits (MiB)</strong> fields</li>
<li>Add <code>80</code> to Port mappings</li>
<li>Ignore the <strong>Advanced container configuration section</strong></li>
<li>Click on <strong>Add</strong> button on bottom right corner</li>
<li>Your screen should look similar to the one below
<img alt="" src="../images/fargate/image085.png" /></li>
<li>Now click <strong>Create</strong></li>
<li>Your Task definition is created successfully</li>
<li>Your screen should look similar to the one below
<img alt="" src="../images/fargate/ecs-task-definition-created-success-msg.png" /></li>
</ul>
<h3 id="create-amazon-ecs-cluster">Create Amazon ECS Cluster</h3>
<blockquote>
<p>In this section we are going to create a Amazon Elastic Container Service cluster. A cluster typically has one or more nodes , which are the workermachines that run your containerized applications and other workloads. This will be deployed in a VPC.</p>
</blockquote>
<ul>
<li>Click on <strong>Clusters</strong> on the ECS home page
<img alt="" src="../images/fargate/createcluster1.png" /></li>
<li>Click on <strong>Create Cluster</strong></li>
<li>Select <strong>Networking Only</strong> option and click <strong>Next step</strong></li>
<li>Name the cluster as <code>hellofargatecluster</code></li>
<li>Check the <strong>Create VPC</strong> checkbox</li>
<li>Type a CIDR range to allocate to your VPC and subnet. You may use online tools to validate subnet CIDR allocation (example <a href="https://cidr.xyz/">https://cidr.xyz/</a> , <a href="https://www.site24x7.com/tools/ipv4-subnetcalculator.html">https://www.site24x7.com/tools/ipv4-subnetcalculator.html</a>)</li>
<li>Delete Subnet 2 by clicking the <em>x</em> to the right and leave other values to default</li>
<li>
<p>Click <strong>Create</strong></p>
<blockquote>
<p>This step will take about a minute to complete. In the background, AWS is creating a <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a> stack with all the input settings.</p>
</blockquote>
</li>
<li>
<p>Amazon ECS cluster is created sucessfully</p>
<blockquote>
<p><strong>Important:</strong> Once complete, make sure you take a note of the VPC name that we just created, since we will use it in the future steps</p>
</blockquote>
</li>
<li>Click on <strong>View Cluster</strong> to see the cluster</li>
</ul>
<h3 id="create-amazon-ecs-service">Create Amazon ECS Service</h3>
<blockquote>
<p>In this step, we will create the Amazon ECS service with Fargate Launch type &amp; manually deploy the latest application docker image (available in Amazon ECR) to this service.</p>
</blockquote>
<ul>
<li>On the newly created cluster page, under <strong>Services</strong> tab, click on <strong>Create</strong>.</li>
<li>Select <strong>FARGATE</strong> for <strong>Launch type</strong> option</li>
<li>Make sure the Task Definition and the Clusters are selected to the ones you just created</li>
<li>Enter <code>hellofargateservice</code> for <strong>Service name</strong> field</li>
<li>Enter <code>1</code> for Number of tasks field and leave everything else as is. Click <strong>Next step</strong></li>
<li>Make sure the VPC drop down has the name of the VPC you just created</li>
<li>Click on the <strong>Subnets</strong> drop down and select the subnet that comes up</li>
<li>Click on <strong>Edit</strong> for <strong>Security groups</strong> and ensure the <strong>Inboud rules for security group</strong> has Port 80 selected. Look at the image below for clarity. Click cancel to exit the <strong>Configure security groups</strong> page
<img alt="" src="../images/fargate/securitygroup.png" /></li>
<li>Select <code>None</code> for Load balancing</li>
<li>Under <strong>Service Discovery (optional)</strong> section uncheck the <strong>Enable service discovery integration</strong> checkbox as this is not required for this lab and click <strong>Next Step</strong></li>
<li>Leave the <strong>Set Auto Scaling</strong> to <em>Do not adjust the service's desired count</em> as it is</li>
<li>Do a quick review of the <strong>Review</strong> screen and click <strong>Create service</strong></li>
<li>The cluster service is now created successfully</li>
<li>Click on <strong>View Service</strong></li>
<li>Go to the <strong>Tasks</strong> tab and check the <strong>Last status</strong> column. It will refresh its status to <strong>RUNNING</strong> and turn green once the provisioning is complete</li>
<li>The current screen should look similar to the one below. Notice that the <strong>Last status</strong> column says <em>PROVISIONING</em> which means the taks is currently being executed
<img alt="" src="../images/fargate/servicestatus1.png" /></li>
<li>Once the value on <strong>Last status</strong> column says <strong>RUNNING</strong> and is green, click on the task name under <strong>Task</strong> column</li>
<li>Copy and paste the value of <strong>Public IP</strong> under <strong>Network</strong> on to a new browser tab and press Enter</li>
<li>You should see the home page of the your new application running on Amazon ECS Fargate
<img alt="" src="../images/fargate/deployed-application-success.png" /></li>
</ul>
<h2 id="create-a-new-azure-devops-release-pipeline">Create a new Azure DevOps Release pipeline</h2>
<blockquote>
<p>In this step, we will setup automated deployment process to update the Amazon ECS Service with the docker image built by the build pipeline.</p>
</blockquote>
<ul>
<li>Go to <strong>Releases</strong> page on your Azure DevOps project</li>
<li>Click <strong>New pipeline</strong></li>
<li>Select <strong>Empty job</strong> under <strong>Select a template</strong></li>
<li>Enter <code>Prod</code> for Stage name field</li>
<li>Change the name of the pipeline to <code>Release to Prod</code>.</li>
<li>Now your screen should look similar to the below screenshot
<img alt="" src="../images/fargate/image052.png" /></li>
<li>Hover your mouse over <strong>1 job, 0 task</strong> link and click on the + sign that becomes visible. This will allow you to add new tasks to the pipeline.</li>
<li>In the next screen, under <strong>Agent job</strong>, select <code>Hosted 2017</code> for <strong>Agent pool</strong> drop down</li>
<li>Now click on the + sign next to <strong>Agent job</strong> and type <em>Command</em> in the search field. Select the <strong>Command Line</strong> task and click <strong>Add</strong></li>
<li>Name the task <code>Install AWS CLI</code> and enter <code>pip install awscli</code> in the <strong>Script</strong> field</li>
<li>Click on the + sign next to <strong>Agent job</strong>. Type <strong>aws</strong> in the search field. Select <strong>AWS CLI</strong> task and click <strong>Add</strong></li>
<li>Name the new task <code>Update ECS Service</code>. Select the name of the AWS credential you configured earlier.</li>
<li>Select <code>EU (Ireland) [eu-west-1]</code> as region</li>
<li>Enter <code>ecs</code> in the <strong>Command</strong> field.</li>
<li>Enter <code>update-service</code> in the <strong>Subcommand</strong> field.</li>
<li>Enter <code>--cluster hellofargatecluster --service hellofargatecontainer-service --force-new-deployment</code> in the <strong>Options and parameters</strong> field
<img alt="" src="../images/fargate/image062.png" /></li>
<li>Save the changes.</li>
</ul>
<h2 id="deploy-application-to-amazon-ecs-fargate-validate">Deploy application to Amazon ECS Fargate &amp; validate</h2>
<blockquote>
<p>In this step, we will create a release using the release pipeline we created in the previous step. Doing this will deploy the container into the cluster using the task definition it is configured to.</p>
</blockquote>
<ul>
<li>Go to <strong>Releases</strong> and select the release pipeline you created earlier.</li>
<li>You should see a screen similar to the one below. Click <strong>Create a release</strong>
<img alt="" src="../images/fargate/image070.png" /></li>
<li>Select <code>Prod</code> in the drop down for <strong>Stages for a trigger change from automated to manual</strong> and click <strong>Create</strong></li>
<li>In the next screen, click on <strong>Release-1</strong> that appears on the green bar
<img alt="" src="../images/fargate/image074.png" /></li>
<li>Your next screen will look similar to the one below. Hover the mouse arrow on <strong>Prod</strong> stage rectangle. Click on <strong>Deploy</strong> button.
<img alt="" src="../images/fargate/image077.png" /></li>
<li>Simply click <strong>Deploy</strong> in the pop-up screen</li>
<li>The job will be queued and will be picked up once an agent gets free. After its complete, your screen should look like the one below
<img alt="" src="../images/fargate/image081.png" /></li>
</ul>
<h2 id="final-steps">Final Steps</h2>
<ul>
<li>Now you have a fully functional Build and Deploy pipeline setup for your application running on Amazon Elastic Cluster Service</li>
<li>Go ahead and make some simple change to the project and do a git push to the repo.</li>
<li>Queue a Build and a Release to see your changes reflecting successfully on your target environment</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../lambda/" title="AWS Lambda" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                AWS Lambda
              </span>
            </div>
          </a>
        
        
          <a href="../resources/" title="Resources" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Resources
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://awsentworkshops.com" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/windows/" class="md-footer-social__link fa fa-globe"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.dc02f8ce.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../javascripts/extra.js"></script>
      
    
  </body>
</html>